#!/usr/bin/env python
# uwphysret_atmos_z2p.py
import numpy as num

def uwphysret_atmos_z2p(arg):
  """r = uwphysret_atmos_z2p(arg)

Clalculates pressure from altitude
Paolo Antonelli
Fri May 28 19:04:59 CDT 2010
  """
  r = num.zeros(arg.size)
  ind1 = num.where(arg < 10769.0)
  ind2 = num.where((arg >= 10769.0) & (arg < 32000.0))
  ind3 = num.where((arg >= 32000.0) & (arg < 50000.0))
  ind4 = num.where((arg >= 50000.0) & (arg < 60000.0))
  ind5 = num.where((arg >= 60000.0) & (arg < 78000.0))
  if ( ind1[0].size > 0 ):
    t = 288.0 - 0.0065*arg[ind1]
    r[ind1] = 1013.25 * (t/288.0) ** 5.2549964
  if ( ind2[0].size > 0 ):
    r[ind2] = 234.53*num.exp(-0.000156698*(arg[ind2]-10769.0))
  if ( ind3[0].size > 0 ):
    t = 218.0 + 0.00733333 * (arg[ind3] - 32000.0)
    r[ind3] = 8.421*(t/218.0) ** (-4.65792)
  if ( ind4[0].size > 0 ):
    r = 0.9282*num.exp(-0.0000975886*(arg[ind4] - 50000.0))
  if ( ind5[0].size > 0 ):
    t = 350.0 - 0.00611111*(arg[ind5] - 60000.0)
    r[ind5] = 0.3498*(t/350.0) ** 5.590518
  return r

if __name__ == '__main__':
  from hypsometric import hypsometric
  print(uwphysret_atmos_z2p.__doc__)
  t = num.array(
      ( 24.54, 23.16, 21.67, 20.23, 18.86, 17.49, 16.10, 14.69, 13.22, 11.52,
         9.53,  7.24,  4.80,  2.34,  0.04, -2.29, -4.84, -7.64,-10.66,-13.95,
       -17.54,-21.45,-25.58,-29.90,-34.33,-38.94,-43.78,-48.80,-53.94,-58.79,
       -63.27,-67.32,-70.74,-73.62,-75.74,-77.07,-77.43,-76.63,-75.06,-73.14,
       -71.43 ))
  t = t + 273.15
  p = num.array(
      ( 1012.0, 991.3, 969.1, 945.5, 920.4, 893.8, 865.7, 836.1, 805.1, 772.8,
         739.5, 705.2, 670.3, 635.0, 599.7, 564.5, 529.8, 495.7, 462.6, 430.7,
         400.0, 370.8, 343.0, 316.7, 292.0, 266.8, 247.2, 227.0, 208.2, 190.8,
         174.7, 159.9, 146.2, 133.6, 121.9, 111.3, 101.5,  92.6,  84.4,  76.9,
          70.0 ))
  r = num.array(
      ( 17.78, 16.92, 15.93, 14.87, 13.78, 12.70, 11.84, 10.96, 10.15,  9.31,
         8.46,  7.73,  7.05,  6.32,  5.62,  4.91,  4.10,  3.30,  2.67,  2.15,
         1.66,  1.26,  0.95,  0.68,  0.45,  0.28,  0.17,  0.10,  0.06,  0.04,
         0.02,  0.02,  0.01,  0.01,  0.01,  0.01,  0.01,  0.01,  0.01,  0.01,
         0.02 ))
  z = hypsometric(p,t,r,0.000)*1000.0
  print(z)
  r = uwphysret_atmos_z2p(z)
  print(r)
